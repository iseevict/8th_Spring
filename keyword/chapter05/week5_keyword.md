**Domain**

- 도메인은 일반적인 요구사항, 전문 용어, 그리고 컴퓨터 프로그래밍 분야에서 문제를 풀기 위해 설계된 어떤 소프트웨어 프로그램에 대한 기능성을 정의하는 영역
- 즉, 도메인은 기획의 요구사항을 구현하고, 문제를 풀기 위해 설계된 소프트웨어 프로그램의 기능성을 정의


  <aside>

    💡

    사용자가 이용하는 앱 기능, 회사의 비즈니스 로직을 정의하는 영역

  </aside>


**양방향 매핑**

- 연관관계
  - 연관관계를 매핑할 때 고려해야할 것은 크게 3가지
    - 방향 : 단방향/양방향
    - 관계의 주인 : 양방향일 때, 연관관계에서 관리 주체
    - 다중성 : 다대일, 일대다, 일대일, 다대다

- 단방향 / 양방향
  - DB와 달리 객체는 **참조용 필드**가 있는 객체만 다른 객체를 참조하는 것이 가능
    - 즉, 두 객체 사이에 하나의 객체만 참조용 필드를 갖는다면 단방향, 두 객체 모두 각각 참조용 필드를 갖는다면 양방향 관계이다.
    - 엄밀하게는 양방향 관계는 없고 단방향을 각각 가져서 양방향 관계처럼 사용하고 있다는 것
  - 단방향과 양방향의 선택은 비즈니스 로직에서 필요여부를 고민해보아야 함
    - A.getB() 처럼 A에서 B를 참조해야할 일이 있다면 A → B 단방향 참조를 추가
    - B.getA() 처럼 B에서 A를 참조해야할 일이 있다면 B → A 단방향 참조를 추가
      - 위와 같이 비즈니스 로직에 맞게 선택했는데 두 객체가 서로 단방향 참조를 했다면?
        - 양방향 연관 관계가 되는 것
- 그렇다면 무조건 양방향 관계를 설정하는 것이 편하지 않나?
  - 우리가 사용하기엔 편함
  - but, 객체 입장에서 양방향 매핑을 하는 경우 오히려 복잡해짐
      - 복잡성 증가
  - 즉, 기본적으로는 단방향 매핑으로 진행, 추후 역방향 객체 탐색이 꼭 필요하다고 판단될 시 사용

- 연관관계의 주인
  - 양방향 관계를 맺는 경우 관계의 주인을 지정해주어야 함
      - 주인을 지정한다는 것은 단방향 관계 2개 (양방향) 중 제어의 권한 (외래 키를 비롯한 테이블 레코드를 저장, 수정, 삭제) 을 갖는 실질적인 관계가 어떤 것인지 선택하는 것
      - 연관관계의 주인은 연관관계를 갖는 두 객체 사이에서 조회, 저장, 수정, 삭제를 할 수 있지만 주인이 아니면 조회만 가능
      - 주인이 아닌 객체에서 **mappedBy 속성**을 사용해서 주인 지정해주어야 함
  - 왜 지정하는가?
      - A와 B 객체가 양방향 연관관계를 맺고있다고 가정
      - 만약 A의 B를 다른 B로 수정하려고 할때 JPA는 A에서 수정할지 B에서 수정할지 혼란을 겪게됨
          - 그렇기에 명확하게 지정하는 것
  - 그렇다면 연관관계의 주인만 제어하면 되는가?
      - 맞긴한데 데이터 동기화를 위해 연관관계의 주인이 아닌 곳에서도 변경해주는 것이 좋다.

- 일대일 양방향 VS 다대일 양방향
  - 그냥 다대일 양방향을 쓰면된다.
      - 일대일 양방향은 공식적으로 존재하는 건 아님
          - **@JoinColumn(updatable = false, insertable = false)** 로 가능은 하다.

**N + 1 문제**

  N + 1 문제란

- ORM 기술에서 특정 객체를 대상으로 수행한 쿼리가 해당 객체의 연관관계로 퍼져나가면서 N 번의 추가적인 쿼리가 발생하는 문제

원인

- RDBMS 와 객체지향 언어간의 패러다임 차이
    - 객체는 언제든 메모리 내에서 접근 가능
    - RDBMS는 Select 으로 조회 가능

예시

- A라는 객체가 B라는 객체와 1:N 으로 연관관계가 설정되어 있을 때
- JPA에서 A라는 객체를 Select 하기 위해 쿼리문을 날릴 경우 A 객체에 List<B> 에 들어있는 모든 객체들을 Select 하는 쿼리문이 같이 날아감